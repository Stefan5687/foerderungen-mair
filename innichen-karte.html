<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesch√§fte in Innichen - Karte</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #map { width: 100%; height: 500px; margin-top: 20px; }
        .input-area { background: #f5f5f5; padding: 15px; border-radius: 8px; }
        textarea { width: 100%; height: 150px; margin-bottom: 10px; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 4px; }
        button:hover { background: #0056b3; }
        .loading { color: #666; font-style: italic; }
    </style>
</head>
<body>
    <h1>üèîÔ∏è Gesch√§fte in Innichen (San Candido)</h1>
    
    <div class="input-area">
        <h3>Adressen eingeben (eine pro Zeile):</h3>
        <textarea id="addresses">Apotheke Hochpustertal, Via Rainer 8, 39038 Innichen
Kaufhaus Sch√§fer, Piazza San Michele 8, 39038 Innichen
Baur Textil, 39038 Innichen
Sport Papin, Innichen
Senfter Metzgerei, Innichen
Sennerei Drei Zinnen, Innichen
Sport Holzer, Innichen
Panificio (B√§ckerei), Innichen
Ottica Cadere, Innichen
Under Colors of Benetton, Innichen</textarea>
        <button onclick="geocodeAddresses()">Karte aktualisieren</button>
        <span id="status" class="loading"></span>
    </div>

    <!-- Karte Container -->
    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Karte initialisieren - zentriert auf Innichen
        var map = L.map('map').setView([46.733, 12.2805], 16);
        
        // OpenStreetMap Tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { 
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        var markers = [];

        // Adressen in Koordinaten umwandeln (Nominatim API)
        async function geocodeAddresses() {
            var textarea = document.getElementById('addresses');
            var lines = textarea.value.split('\n').filter(line => line.trim() !== '');
            var status = document.getElementById('status');
            
            // Alte Marker entfernen
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            
            status.textContent = 'Lade Adressen... (' + lines.length + ')';
            
            for (var i = 0; i < lines.length; i++) {
                var address = lines[i] + ', S√ºdtirol, Italien';
                status.textContent = 'Suche: ' + lines[i] + ' (' + (i+1) + '/' + lines.length + ')';
                
                try {
                    var response = await fetch('https://nominatim.openstreetmap.org/search?format=json&q=' + encodeURIComponent(address));
                    var data = await response.json();
                    
                    if (data && data.length > 0) {
                        var lat = parseFloat(data[0].lat);
                        var lon = parseFloat(data[0].lon);
                        
                        // Marker hinzuf√ºgen
                        var marker = L.marker([lat, lon]).addTo(map);
                        marker.bindPopup('<b>' + lines[i] + '</b><br>' + data[0].display_name);
                        markers.push(marker);
                    }
                } catch (e) {
                    console.log('Fehler bei: ' + lines[i]);
                }
                
                // API-Limit respektieren
                await new Promise(r => setTimeout(r, 1000));
            }
            
            // Karte anpassen
            if (markers.length > 0) {
                var group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
            
            status.textContent = 'Fertig! ' + markers.length + ' Adressen gefunden.';
        }

        // Beim Start einmal ausf√ºhren
        geocodeAddresses();
    </script>
</body>
</html>
